/*! timeline - v1.0 - 2013-09-02 4:34:31 PM
* Copyright (c) 2013 paozhu; Licensed  */
KISSY.add("gallery/timeline/1.0/index",function(a,b){var c=a.DOM,d=b.all,e="<div class='fb-block'><div class='fb-title'><h1>{title}</h1><h2>{date}</h2></div><div class='fb-content'><p>{content}</p></div></div><i class='fb-{pos}-pointer'></i>",f={fb:e},g=function(){this._init.apply(this,arguments)};return a.augment(g,{_init:function(b,c,d){return a.isString(b)&&(b=a.one(b)),this.target=b,this.data=c,this._buildParam(c,d),this._buildHtml(),this._setStyle(),this.render(),this},_buildParam:function(b,c){function d(a,b){var d=c[b];i[b]=void 0===d||null===d?a:d}function e(a,b){for(var c=0,d=i.data.length;d>c;c++){var e=i.data[c][b];i.data[c][b]=void 0===e||null===e?a:e}}function g(b,d){var e=c[d];i[d]=a.merge(b,e)}function h(a){i[a]=parseInt(i[a])}var i=this;return(void 0===c||null===c)&&(c={}),a.each({start_pos:"left",container_width:600,line_width:28,item_gap_space:30,top_gap_space:15,bottom_gap_space:15},d),a.each(["container_width","line_width","line_width","item_gap_space","top_gap_space"],h),a.each({html_template:f},g),a.each({template:"fb",pos:"",date:"\u6211\u662f\u65e5\u671f",title:"\u6211\u662f\u6807\u9898",content:"\u6211\u662f\u5185\u5bb9"},e),this},_setStyle:function(){this.item_width=(this.container_width-this.line_width)/2,c.css(this.target,"width",this.container_width),c.css(this.target,"position","relative");var a=".tl-line {  width: "+this.line_width+"px;"+"  position: absolute;"+"  z-index: 10;"+"  left: "+(this.container_width-this.line_width)/2+"px;"+"}"+".tl-item {"+"  position: absolute;"+"  width: "+this.item_width+"px;"+"  z-index: 15;"+"}"+".tl-left{"+"  left: 0px;"+"}"+".tl-right{"+"  right: 0px;"+"}"+".tl-center{"+"  left: "+(this.container_width-this.item_width)/2+"px;"+"}";d("<style>"+a+"</style>").appendTo("head")},_buildHtml:function(){var a="<div class='tl-line'></div><div class='tl-left' style='top: "+(this.top_gap_space-this.item_gap_space)+"px;'></div>"+"<div class='tl-right' style='top:"+(this.top_gap_space-this.item_gap_space)+"px;'></div>";c.append(c.create(a),this.target)},render:function(){this._alternateRender()},_nextPos:function(a){return"left"==a?"right":"left"},_calLastTop:function(){var a,b,d,e,f;return a=c.last(this.target),c.hasClass(a,"tl-right")?(f=parseInt(c.style(a,"top"))+c.height(a),b=c.children(this.target,".tl-left").pop(),e=parseInt(c.style(b,"top"))+c.height(b)):c.hasClass(a,"tl-left")?(e=parseInt(c.style(a,"top"))+c.height(a),d=c.children(this.target,".tl-right").pop(),f=parseInt(c.style(d,"top"))+c.height(d)):(e=parseInt(c.style(a,"top"))+c.height(a),f=e),{left:e,right:f}},_calHeight:function(){var a=c.last(this.target);return parseInt(c.style(a,"top"))+c.height(a)},_alternateRender:function(){for(var b,d,e,f,g=this.start_pos,h=0,i=0,j=this.item_gap_space,k=0,l=this.data.length;l>k;k++)e=this._calLastTop(g),h=e.left,i=e.right,"left"===this.data[k].pos||"right"===this.data[k].pos||"center"===this.data[k].pos?g=this.data[k].pos:this.data[k].pos=g,d=h+j>i+j?h+j:i+j,b=this.html_template[this.data[k].template],b=a.substitute(b,this.data[k]),b="<div class='tl-item tl-"+g+"' style='top:"+d+"px'>"+b+"</div>",c.append(c.create(b),this.target),g=this._nextPos(g),f=this._calHeight(),c.css(c.get(".tl-line",this.target),"height",this._calHeight()+this.bottom_gap_space),c.css(this.target,"height",this._calHeight()+this.bottom_gap_space)}}),g},{requires:["node","base"]});